name: 'PocketPal AI Android Release Build'  on:   push:     branches:       - main     tags:       - 'v*'   workflow_dispatch:     inputs:       build_type:         description: 'Build type'         required: true         default: 'release'         type: choice         options:           - debug           - release  env:   ANDROID_SDK_ROOT: ${{ steps.android-sdk.outputs.sdk-root }}   JAVA_HOME: ${{ steps.setup-java.outputs.path }}   GRADLE_OPTS: "-Dorg.gradle.jvmargs=-Xmx6g -Dfile.encoding=UTF-8"  jobs:   build-release:     name: 'Build Release APK'     runs-on: ubuntu-latest     timeout-minutes: 90      steps:       - name: 'æ£€å‡ºä»£ç '         uses: actions/checkout@v4         with:           fetch-depth: 0        - name: 'è®¾ç½® Node.js ç¯å¢ƒ'         uses: actions/setup-node@v3         with:           node-version: '18.x'           cache: 'yarn'        - name: 'è®¾ç½® JDK 17'         uses: actions/setup-java@v4         with:           java-version: '17'           distribution: 'temurin'           cache: 'gradle'        - name: 'è®¾ç½® Android SDK'         id: android-sdk         uses: android-actions/setup-android@v3         with:           cmdline-tools-version: 12266719           accept-android-sdk-licenses: 'yes'           packages: |             platform-tools             build-tools;34.0.0             android-16             android-17             android-18        - name: 'ä½¿ Gradle Wrapper å¯æ‰§è¡Œ'         run: chmod +x ./gradlew        - name: 'ç¼“å­˜ Gradle ä¾èµ–'         uses: actions/cache@v3         with:           path: |             ~/.gradle/caches             ~/.gradle/wrapper             android/.gradle           key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}           restore-keys: |             ${{ runner.os }}-gradle-        - name: 'å®‰è£…ä¾èµ–'         run: |           yarn install --frozen-lockfile           cd android && ./gradlew clean        - name: 'é…ç½® AI ä¼˜åŒ–å‚æ•°'         run: |           echo "org.gradle.jvmargs=-Xmx6g -Dfile.encoding=UTF-8" >> android/gradle.properties           echo "org.gradle.parallel=true" >> android/gradle.properties           echo "org.gradle.configureondemand=true" >> android/gradle.properties           echo "org.gradle.caching=true" >> android/gradle.properties           echo "org.gradle.daemon=true" >> android/gradle.properties           echo "org.gradle.continuous=true" >> android/gradle.properties           echo "org.gradle.jitwatch=true" >> android/gradle.properties                      echo "reactNative.architectures=arm64-v8a" >> android/gradle.properties           echo "reactNative.jscAndroid.enableHermes=true" >> android/gradle.properties                      echo "android.enableJetifier=true" >> android/gradle.properties           echo "android.useAndroidX=true" >> android/gradle.properties           echo "android.nonTransitiveRClass=true" >> android/gradle.properties           echo "android.enableR8.fullMode=true" >> android/gradle.properties        - name: 'æ„å»º Release APK'         run: |           cd android           ./gradlew assembleRelease \             --no-daemon \             --max-workers=4 \             --parallel \             --configuration-on-demand \             --build-cache \             --continuous \             --info \             --stacktrace \             -Dorg.gradle.jvmargs="${GRADLE_OPTS}" \             -Dorg.gradle.parallel=true \             -Dorg.gradle.configureondemand=true \             -Dorg.gradle.caching=true        - name: 'éªŒè¯ APK'         run: |           cd android           ls -la app/build/outputs/apk/release/                      if [ ! -f "app/build/outputs/apk/release/app-release.apk" ]; then             echo "âŒ APK æœªæ‰¾åˆ°!"             exit 1           fi                      echo "âœ… APK æ„å»ºæˆåŠŸ!"           echo "ğŸ“¦ APK å¤§å°: $(du -h app/build/outputs/apk/release/app-release.apk | cut -f1)"           echo "ğŸ“… æ„å»ºæ—¶é—´: $(date)"        - name: 'ä¸Šä¼  Release APK'         uses: actions/upload-artifact@v4         with:           name: pocketpal-ai-release-apk           path: android/app/build/outputs/apk/release/*.apk           retention-days: 30           if-no-files-found: error        - name: 'åˆ›å»º GitHub Release'         if: startsWith(github.ref, 'refs/tags/')         uses: actions/create-release@v1         env:           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}         with:           tag_name: ${{ github.ref_name }}           release_name: PocketPal AI ${{ github.ref_name }}           draft: false           prerelease: false           body: |             ## ğŸš€ PocketPal AI ${{ github.ref_name }} å‘å¸ƒ                          ### ğŸ“± å®‰è£…è¯´æ˜ - ä¸‹è½½ `pocketpal-ai-release.apk` æ–‡ä»¶ - åœ¨ Android è®¾å¤‡ä¸Šå¯ç”¨"å®‰è£…æœªçŸ¥æ¥æºåº”ç”¨"æƒé™ - å®‰è£… APK æ–‡ä»¶                          ### ğŸ†• æ›´æ–°å†…å®¹             - æŸ¥çœ‹å®Œæ•´å˜æ›´æ—¥å¿—: https://github.com/${{ github.repository }}/compare/${{ github.event.before }}...${{ github.sha }}                          ### ğŸ”— ä¸‹è½½é“¾æ¥             - [pocketpal-ai-release.apk](${{ steps.upload-apk.outputs.download_url }})           files: |             android/app/build/outputs/apk/release/pocketpal-ai-release.apk
